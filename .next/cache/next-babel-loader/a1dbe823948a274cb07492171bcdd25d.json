{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nvar __jsx = React.createElement;\nimport React, { useEffect } from 'react';\n//Import Components\nimport Layout from '../../components/Layout/Layout';\nimport BannerSlider from \"../../components/PageDetail/BannerSlider\";\nimport Main from \"../../components/Project/ProjectMain\"; //Import Const\n\nimport { apolloClient } from \"../../utils\";\nimport { GET_PROJECT_BY_SLUG } from \"../../graphql/project/queries\";\nimport { GET_INVESTOR_BY_ID } from \"../../graphql/investor/queries\"; //Import Module\n\nimport StringProcess from \"../../modules/stringProcess\"; //Import SCSS\n\nimport \"../../assets/scss/style.scss\";\nimport { localStorageCompareKey, mainURL } from \"../../constants\";\nimport urlProcess from \"../../modules/urlProcess\";\nimport Validator from \"../../modules/validator\";\nimport { COUNT_VIEW_PROJECT } from \"../../graphql/project/mutation\";\n\n// @ts-ignore\nvar ProjectDetailPage = function ProjectDetailPage(props) {\n  var title = props.projectDetail.data.project.name ? props.projectDetail.data.project.name : 'Xem chi tiết dự án';\n  var albumImage = props.projectDetail.data.project.image;\n  var typeProject = '';\n  var statusProject = '';\n  var yearBuildProject = '';\n\n  var square = __jsx(React.Fragment, null, \"m\", __jsx(\"sup\", null, \"2\"));\n\n  var areaString = __jsx(React.Fragment, null, StringProcess.addCommas(props.projectDetail.data.project.land_area), \" \", square);\n\n  var imageAvatar = 'https://static.nhadatmoi.net/default/home_default.jpg';\n\n  if (props.projectDetail.data.project.cover_image) {\n    imageAvatar = urlProcess.processImageUrl(props.projectDetail.data.project.cover_image, 'project');\n  }\n\n  var freshText = function freshText(input) {\n    input = StringProcess.stripProperties(input, []);\n    input = StringProcess.stripTags(input, '');\n    input = input.replace(/&nbsp;/g, ' ');\n    return input;\n  };\n\n  var convertDescription = function convertDescription(input) {\n    return input.replace(/&#(\\d+);/g, function (match, dec) {\n      return String.fromCharCode(dec);\n    });\n  };\n\n  var metaTitle = '';\n  var metaDescription = '';\n\n  if (props.projectDetail.data.project.seo_title) {\n    metaTitle = props.projectDetail.data.project.seo_title;\n  }\n\n  if (props.projectDetail.data.project.seo_description) {\n    metaDescription = props.projectDetail.data.project.seo_description;\n  }\n\n  if (metaTitle === '' || !metaTitle) {\n    metaTitle = title;\n  }\n\n  if (metaDescription === '' || !metaDescription) {\n    metaDescription = freshText(props.projectDetail.data.project.intro_content);\n    metaDescription = convertDescription(metaDescription);\n    metaDescription = StringProcess.truncateString(metaDescription, 255, '');\n  }\n\n  var initStateInvestor = {\n    id: \"\",\n    name: \"\",\n    description: \"\",\n    slug: \"\",\n    email: \"\",\n    website: \"\",\n    image: \"\",\n    address: {\n      text: \"\"\n    },\n    phone: \"\",\n    mobile: \"\"\n  }; //Count Ad Sell Lease\n\n  var _React$useState = React.useState(initStateInvestor),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      investor = _React$useState2[0],\n      setInvestor = _React$useState2[1];\n\n  useEffect(function () {\n    var projectId = props.projectDetail.data.project.id;\n    apolloClient.mutate({\n      mutation: COUNT_VIEW_PROJECT,\n      variables: {\n        \"input\": {\n          \"id\": projectId\n        }\n      }\n    }).then(function (response) {});\n    var investorId = props.projectDetail.data.project.investor;\n    apolloClient.query({\n      query: GET_INVESTOR_BY_ID,\n      variables: {\n        \"id\": investorId\n      }\n    }).then(function (response) {\n      if (!Validator.isBlank(response.data) && !Validator.isBlank(response.data.investor)) {\n        setInvestor(response.data.investor);\n      }\n    });\n  }, []);\n\n  var _React$useState3 = React.useState({}),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      dataCompare = _React$useState4[0],\n      setDataCompare = _React$useState4[1];\n\n  var _updateCompareData = function updateCompareData(data) {\n    var dataToCompare = [];\n    var isAddToLocal = true;\n\n    if (localStorage.getItem(localStorageCompareKey) && !Validator.isBlank(localStorage.getItem(localStorageCompareKey))) {\n      dataToCompare = JSON.parse(localStorage.getItem(localStorageCompareKey));\n\n      for (var index in dataToCompare) {\n        if (dataToCompare[index].id === data.id) {\n          isAddToLocal = false;\n        }\n\n        if (dataToCompare[index].type !== data.type) {\n          localStorage.removeItem(localStorageCompareKey);\n          dataToCompare = [];\n          break;\n        }\n      }\n    }\n\n    if (isAddToLocal) {\n      dataToCompare.push(data); // @ts-ignore\n\n      setDataCompare(dataToCompare);\n      localStorage.setItem(localStorageCompareKey, _JSON$stringify(dataToCompare));\n    }\n  };\n\n  var propertyOverview = {\n    id: props.projectDetail.data.project.id,\n    slug: props.slug,\n    video: props.projectDetail.data.project.video,\n    building_density: '',\n    financial_support: props.projectDetail.data.project.financial_support,\n    type: typeProject,\n    status: statusProject,\n    floor_number: 0,\n    living_room_number: 0,\n    bed_room_number: 0,\n    toilet_room_number: 0,\n    gara_number: 0,\n    material: '',\n    length: '',\n    width: '',\n    price: \"\",\n    area: areaString,\n    year_built: yearBuildProject,\n    address: props.projectDetail.data.project.address,\n    size: '-',\n    description: props.projectDetail.data.project.intro_content,\n    map: {\n      lat: props.projectDetail.data.project.google_map_latitude,\n      lng: props.projectDetail.data.project.google_map_longitude\n    },\n    title: title,\n    view_count: props.projectDetail.data.project.view_count,\n    updated_at: props.projectDetail.data.project.updated_at,\n    created_at: props.projectDetail.data.project.created_at,\n    position_content: props.projectDetail.data.project.position_content,\n    infrastructure_content: props.projectDetail.data.project.infrastructure_content\n  };\n  var contactDefault = {\n    image: '',\n    name: '',\n    address: '',\n    mobile: '',\n    phone: '',\n    email: ''\n  };\n  return __jsx(Layout, _extends({\n    title: metaTitle,\n    description: metaDescription\n  }, props, {\n    image: imageAvatar,\n    canonical: mainURL + '/du-an/' + props.slug,\n    path: 'du-an',\n    dataCompare: dataCompare\n  }), __jsx(BannerSlider, {\n    images: albumImage,\n    imageType: \"project\"\n  }), __jsx(Main, {\n    propertyOverview: propertyOverview,\n    block: props.projectDetail.data.project.block,\n    images: albumImage,\n    contact: contactDefault,\n    imageType: \"project\",\n    investor: investor,\n    objectUrl: mainURL + '/du-an/' + props.slug,\n    avatar: props.projectDetail.data.project.cover_image,\n    updateCompareData: function updateCompareData(data) {\n      return _updateCompareData(data);\n    }\n  }));\n}; // @ts-ignore\n\n\nProjectDetailPage.getInitialProps = function _callee(props) {\n  var projectSlug, projectDetail;\n  return _regeneratorRuntime.async(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          projectSlug = props.query.slug;\n          _context.next = 3;\n          return _regeneratorRuntime.awrap(apolloClient.query({\n            query: GET_PROJECT_BY_SLUG,\n            variables: {\n              \"slug\": projectSlug\n            }\n          }).then(function (response) {\n            return response;\n          }));\n\n        case 3:\n          projectDetail = _context.sent;\n          return _context.abrupt(\"return\", {\n            projectDetail: projectDetail,\n            slug: projectSlug\n          });\n\n        case 5:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  });\n};\n\nexport default ProjectDetailPage;","map":null,"metadata":{},"sourceType":"module"}